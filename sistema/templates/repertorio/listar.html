{% extends "base.html" %}
{% load static %}
{% load duration_tags %}

{% block titulo %} Listagem de repertórios {% endblock %}

{% block conteudo %}

<div class="container mt-4">
    <div class="busca mb-4">
        <form method="get" class="d-flex">
            <input type="text" name="busca" class="form-control me-2" 
                   placeholder="Procurar" value="{{ request.GET.busca }}">
            <button class="btn btn-primary" type="submit">Procurar</button>
        </form>
    </div>

    <p class="fw-semibold mb-3">Quantidade de repertórios: 
        <span class="badge bg-primary">{{ meu_repertorio|length }}</span>
    </p>

    <div class="row g-3">
        {% for item in meu_repertorio %}
    <div class="col-12 col-sm-6 col-md-4">
            <div class="card p-3">
                {% comment %} Poster on top, info below for stronger emphasis on image {% endcomment %}
                <div class="d-flex justify-content-center mb-3">
                    {% if item.foto %}
                        <div class="poster-box">
                            <img src="{{ item.foto.url }}" class="poster-img" alt="Foto do repertório">
                        </div>
                    {% else %}
                        <div class="poster-box" style="background:#F1F3F4;">
                            <div class="placeholder">Sem foto</div>
                        </div>
                    {% endif %}
                </div>

                <div class="card-body text-center">
                    <h5 class="card-title mb-2">{{ item.nome }}</h5>
                    <p class="mb-1"><strong>Tipo:</strong> {{ item.get_tipo_display }}</p>
                    <p class="mb-1"><strong>Data:</strong> {{ item.data|date:"d/m/Y" }}</p>
                    <p class="mb-1"><strong>Estrelas:</strong> {{ item.get_estrela_display }}</p>
                    {% if item.tipo == 'SERIE' and item.temporada %}
                        <p class="mb-1"><strong>Temporada:</strong> {{ item.temporada }}</p>
                    {% endif %}
                    {% if item.duracao %}
                        <p class="mb-1"><strong>Duração:</strong> {{ item.duracao|hhmm }}</p>
                    {% endif %}
                    <p class="mt-2 text-muted">{{ item.resenha }}</p>
                </div>

                <div class="card-footer bg-transparent border-0">
                    <div class="d-flex justify-content-end">
                        <a class="btn btn-sm btn-outline-primary me-2" href="{% url 'editar-repertorio' item.pk %}">Editar</a>
                        <a class="btn btn-sm btn-outline-danger" href="{% url 'deletar-repertorio' item.pk %}" onclick="return confirm('Tem certeza que deseja apagar este repertório?')">Apagar</a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                Nenhum repertório cadastrado.
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}